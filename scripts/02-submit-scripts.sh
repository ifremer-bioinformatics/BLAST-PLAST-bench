#!/usr/bin/env bash

# ###
#
#  A script to sumbit automatically BLAST jobs generated by
#  01-generate-scripts.sh.
#
#  Use:
#
#   ./02-submit-scripts.sh
#
#  @author Patrick G. Durand, Ifremer, Nov 2017
# 

# File containing list of generated scripts
# (file created by generate_scripts.sh)
SCRIPTLISTFILE="script_list.txt"

# File that will contain PBS Job IDs
JOBFILE="job-list.txt"
[ -e $JOBFILE ] && rm $JOBFILE
touch $JOBFILE

nbscriptok=0
nbscriptko=0
while IFS= read -r SCRIPT
do
  echo "Submitting $SCRIPT to PBS ... "
  JOBID=`qsub $SCRIPT` 
  if [[ "$JOBID" == *"datarmor"* ]] ; then
    echo "  OK: $JOBID"
    echo "$SCRIPT:$JOBID" >> $JOBFILE
    nbscriptok=$((nbscriptok+1))
  else
    echo "  KO"
    nbscriptko=$((nbscriptko+1))
  fi
done < "$SCRIPTLISTFILE"

echo ""
echo "$nbscriptok scripts submitted"
echo "$nbscriptko scripts NOT submitted (check KO lines, above)"
echo "Job file is: $JOBFILE"
echo "You can now use '03-alter-wtime.sh' if needed"


